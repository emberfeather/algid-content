(function(b){function i(c,a){var d=b(a);d.data("original",d.text())}function j(c){c=b(c.target);c.data("original")!=c.text()&&b.api({plugin:"content",service:"path",action:"renamePath"},{title:c.text(),pathID:c.parents("[data-pathID]").attr("data-pathID")},{success:function(a){a.HEAD.result||window.console.error(a.HEAD.errors)}})}function k(){var c=[];g.each(function(){var a;a=b(this);var d={navigationID:a.attr("data-navigationID"),paths:a.sortable("toArray")};for(a=0;a<d.paths.length;a++)d.paths[a]=
d.paths[a].substr(5);c.push(d)});b.api({plugin:"content",service:"navigation",action:"setPositions"},{path:h.val(),positions:c},{success:function(a){if(!a.HEAD.result){b(".content").after(b("<div />",{html:a.HEAD.errors.HEAD.error.detail}));b(".content").after(b("<div />",{html:a.HEAD.errors.HEAD.error.stacktrace}));window.console.error(a.HEAD.errors)}}})}var g,h;b(function(){var c={};g=b(".sortable");h=b("#path");g.each(function(){b(this).sortable({connectWith:g,stop:k})});b(".title",g).each(i).blur(j);
h.autocomplete({select:function(){h.parent().trigger("submit")},source:function(a,d){a.term in c?d(c[a.term]):b.api({plugin:"content",service:"path",action:"searchPath"},{path:a.term},{success:function(e){if(e.HEAD.result){for(var f=0;f<e.BODY.length;f++){e.BODY[f].value=e.BODY[f].path;e.BODY[f].label=e.BODY[f].path}c[a.term]=e.BODY;d(e.BODY)}else{window.console.error&&window.console.error(e.HEAD.errors);d([])}}})},minLength:0})})})(jQuery);
