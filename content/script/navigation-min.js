(function(a){function k(d,b){var c,e,h;if(d.ctrlKey||d.metaKey||d.which===2)c=a(b.item[0]).clone(!0),e=c.data("previousIndex"),h=a(b.sender[0]),e===0?h.prepend(c):a("li:eq("+(e-1)+")",h).after(c)}function i(){var d=[];f.each(function(){var b;b=a(this);var c={navigationID:b.attr("data-navigationID"),paths:b.sortable("toArray")};for(b=0;b<c.paths.length;b++)c.paths[b]={pathID:c.paths[b].substr(5),groupBy:""},c.paths[b].title=a("[data-pathid="+c.paths[b].pathID+"] input.title").val();d.push(c)});a.api({plugin:"content",
service:"navigation",action:"setPositions"},{path:g.val(),positions:d},{success:function(b){b.HEAD.result||(a(".content").after(a("<div />",{html:b.HEAD.errors.HEAD.error.detail})),a(".content").after(a("<div />",{html:b.HEAD.errors.HEAD.error.stacktrace})),window.console.error(b.HEAD.errors))}});j()}function j(){f.each(function(){a("li",this).each(function(d){a(this).data("previousIndex",d)})})}var f,g;a(function(){var d={};f=a(".sortable");g=a("#path");j();f.sortable({connectWith:f,receive:k,stop:i});
a(".title",f).change(i);g.autocomplete({delay:280,select:function(){g.parent().trigger("submit")},source:function(b,c){var e;d[b.term]!==void 0?c(d[b.term]):a.api({plugin:"content",service:"path",action:"searchPath"},{path:b.term},{success:function(a){if(a.HEAD.result){for(e=0;e<a.BODY.length;e++)a.BODY[e].value=a.BODY[e].path,a.BODY[e].label=a.BODY[e].path;d[b.term]=a.BODY;c(a.BODY)}else window.console.error&&window.console.error(a.HEAD.errors),c([])}})},minLength:1})})})(jQuery);
