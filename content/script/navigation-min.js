(function(b){function k(e,a){var c,d,f;if(e.ctrlKey||e.metaKey||e.which===2){c=b(a.item[0]).clone(true);d=c.data("previousIndex");f=b(a.sender[0]);d===0?f.prepend(c):b("li:eq("+(d-1)+")",f).after(c)}}function i(){var e=[];g.each(function(){var a;a=b(this);var c={navigationID:a.attr("data-navigationID"),paths:a.sortable("toArray")};for(a=0;a<c.paths.length;a++){c.paths[a]={pathID:c.paths[a].substr(5),groupBy:""};c.paths[a].title=b("[data-pathid="+c.paths[a].pathID+"] input.title").val()}e.push(c)});
b.api({plugin:"content",service:"navigation",action:"setPositions"},{path:h.val(),positions:e},{success:function(a){if(!a.HEAD.result){b(".content").after(b("<div />",{html:a.HEAD.errors.HEAD.error.detail}));b(".content").after(b("<div />",{html:a.HEAD.errors.HEAD.error.stacktrace}));window.console.error(a.HEAD.errors)}}});j()}function j(){g.each(function(){b("li",this).each(function(e){b(this).data("previousIndex",e)})})}var g,h;b(function(){var e={};g=b(".sortable");h=b("#path");j();g.sortable({connectWith:g,
receive:k,stop:i});b(".title",g).change(i);h.autocomplete({delay:125,select:function(){h.parent().trigger("submit")},source:function(a,c){a.term in e?c(e[a.term]):b.api({plugin:"content",service:"path",action:"searchPath"},{path:a.term},{success:function(d){if(d.HEAD.result){for(var f=0;f<d.BODY.length;f++){d.BODY[f].value=d.BODY[f].path;d.BODY[f].label=d.BODY[f].path}e[a.term]=d.BODY;c(d.BODY)}else{window.console.error&&window.console.error(d.HEAD.errors);c([])}}})},minLength:1})})})(jQuery);
